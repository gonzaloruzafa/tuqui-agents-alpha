{
  "name": "Conversational Context Tests - Real User Scenarios",
  "description": "Tests que simulan conversaciones reales con contexto acumulado",
  "version": "2.0.0",
  "timeout": 180000,
  "tenantId": "de7ef34a-12bd-4fe9-9d02-3d876a9393c2",
  "focus": "multi-turn conversations, context awareness, tool execution reliability",
  "categories": [
    {
      "id": "CONTEXT_SALES",
      "name": "Ventas con Contexto",
      "description": "Conversaciones sobre ventas con seguimiento"
    },
    {
      "id": "CONTEXT_PRICING",
      "name": "Pricing con Comparaciones",
      "description": "Consultas de precios con análisis comparativo"
    },
    {
      "id": "CONTEXT_EXECUTIVE",
      "name": "Dashboard Ejecutivo",
      "description": "Preguntas ejecutivas con drill-down"
    },
    {
      "id": "CONTEXT_OPERATIONS",
      "name": "Operaciones con Follow-up",
      "description": "Consultas operativas con contexto"
    }
  ],
  "conversations": [
    {
      "id": "CONV_SALES_001",
      "category": "CONTEXT_SALES",
      "name": "Análisis de ventas con drill-down progresivo",
      "priority": "critical",
      "expectedBehavior": {
        "routing": "Debe mantener contexto de 'vendedor' entre turnos",
        "toolExecution": "Debe ejecutar odoo_intelligent_query en cada turno",
        "dataConsistency": "Los montos deben ser consistentes entre preguntas"
      },
      "turns": [
        {
          "turn": 1,
          "message": "¿Cuánto vendimos hoy?",
          "expectedAgent": "odoo",
          "shouldContain": ["$", "vendimos", "hoy"],
          "shouldNotSay": ["no tengo acceso", "no puedo"],
          "mustExecuteTool": "odoo_intelligent_query",
          "timeoutMs": 15000,
          "saveContext": {
            "key": "ventas_hoy",
            "extractPattern": "\\$ ([\\d.,]+)"
          }
        },
        {
          "turn": 2,
          "message": "¿Quién fue el vendedor que más vendió?",
          "expectedAgent": "odoo",
          "shouldContain": ["vendedor", "más"],
          "mustExecuteTool": "odoo_intelligent_query",
          "timeoutMs": 15000,
          "contextAware": true,
          "saveContext": {
            "key": "top_vendedor",
            "extractPattern": "(\\w+ \\w+)"
          }
        },
        {
          "turn": 3,
          "message": "¿Cuánto vendió ese vendedor?",
          "expectedAgent": "odoo",
          "shouldContain": ["$"],
          "mustExecuteTool": "odoo_intelligent_query",
          "mustUseContext": "top_vendedor",
          "contextAware": true,
          "timeoutMs": 15000
        },
        {
          "turn": 4,
          "message": "¿Y qué productos vendió?",
          "expectedAgent": "odoo",
          "shouldContain": ["producto"],
          "mustExecuteTool": "odoo_intelligent_query",
          "mustUseContext": "top_vendedor",
          "contextAware": true,
          "timeoutMs": 15000
        }
      ]
    },
    {
      "id": "CONV_PRICING_001",
      "category": "CONTEXT_PRICING",
      "name": "Análisis de precios con búsqueda en MeLi",
      "priority": "critical",
      "expectedBehavior": {
        "routing": "Debe detectar cambio de contexto Odoo → MeLi → comparación",
        "toolExecution": "Debe ejecutar ecommerce_search sin decir 'voy a buscar'",
        "responseQuality": "Debe mostrar precios reales sin placeholders"
      },
      "turns": [
        {
          "turn": 1,
          "message": "¿A cuánto vendemos el autoclave de 18 litros?",
          "expectedAgent": "odoo",
          "shouldContain": ["$"],
          "mustExecuteTool": "odoo_intelligent_query",
          "timeoutMs": 15000,
          "saveContext": {
            "key": "precio_nuestro",
            "extractPattern": "\\$ ([\\d.,]+)"
          }
        },
        {
          "turn": 2,
          "message": "Ahora buscame cuánto sale en MercadoLibre",
          "expectedAgent": "meli",
          "shouldContain": ["$", "MercadoLibre"],
          "shouldNotSay": ["dame un toque", "voy a buscar", "chequeando", "espera"],
          "mustExecuteTool": "ecommerce_search",
          "timeoutMs": 60000,
          "saveContext": {
            "key": "precio_mercado",
            "extractPattern": "\\$ ([\\d.,]+)"
          }
        },
        {
          "turn": 3,
          "message": "¿Estamos caros o baratos?",
          "expectedAgent": "meli",
          "shouldContain": ["caro", "barato", "competitivo"],
          "contextAware": true,
          "mustUseContext": ["precio_nuestro", "precio_mercado"],
          "timeoutMs": 10000
        }
      ]
    },
    {
      "id": "CONV_EXEC_001",
      "category": "CONTEXT_EXECUTIVE",
      "name": "Dashboard ejecutivo con comparativas temporales",
      "priority": "high",
      "expectedBehavior": {
        "routing": "Debe mantener contexto temporal entre preguntas",
        "toolExecution": "Debe ejecutar queries con filtros temporales correctos",
        "insights": "Debe generar comparaciones automáticas"
      },
      "turns": [
        {
          "turn": 1,
          "message": "Dame las ventas de este mes",
          "expectedAgent": "odoo",
          "shouldContain": ["$", "enero", "2026"],
          "shouldNotSay": ["no hay ventas", "no tengo acceso"],
          "mustExecuteTool": "odoo_intelligent_query",
          "timeoutMs": 15000,
          "saveContext": {
            "key": "ventas_mes_actual",
            "extractPattern": "\\$ ([\\d.,]+)"
          }
        },
        {
          "turn": 2,
          "message": "¿Y el mes pasado?",
          "expectedAgent": "odoo",
          "shouldContain": ["$", "diciembre"],
          "mustExecuteTool": "odoo_intelligent_query",
          "contextAware": true,
          "timeoutMs": 15000,
          "saveContext": {
            "key": "ventas_mes_anterior",
            "extractPattern": "\\$ ([\\d.,]+)"
          }
        },
        {
          "turn": 3,
          "message": "¿Subimos o bajamos?",
          "expectedAgent": "odoo",
          "shouldContain": ["subimos", "bajamos", "aumentamos", "disminuimos", "%"],
          "contextAware": true,
          "mustUseContext": ["ventas_mes_actual", "ventas_mes_anterior"],
          "timeoutMs": 10000
        }
      ]
    },
    {
      "id": "CONV_OPS_001",
      "category": "CONTEXT_OPERATIONS",
      "name": "Consultas operativas con filtros progresivos",
      "priority": "high",
      "expectedBehavior": {
        "routing": "Debe interpretar 'esos' y 'cuáles' como referencias al contexto",
        "toolExecution": "Debe refinar queries basándose en respuestas previas",
        "dataQuality": "Debe mostrar nombres reales de productos/clientes"
      },
      "turns": [
        {
          "turn": 1,
          "message": "¿Qué clientes nos deben plata?",
          "expectedAgent": "odoo",
          "shouldContain": ["cliente", "$"],
          "mustExecuteTool": "odoo_intelligent_query",
          "timeoutMs": 15000
        },
        {
          "turn": 2,
          "message": "¿Cuánto es el total?",
          "expectedAgent": "odoo",
          "shouldContain": ["$"],
          "mustExecuteTool": "odoo_intelligent_query",
          "contextAware": true,
          "timeoutMs": 15000
        },
        {
          "turn": 3,
          "message": "Dame el detalle del que más debe",
          "expectedAgent": "odoo",
          "shouldContain": ["factura", "$"],
          "mustExecuteTool": "odoo_intelligent_query",
          "contextAware": true,
          "timeoutMs": 15000
        }
      ]
    },
    {
      "id": "CONV_CASH_001",
      "category": "CONTEXT_OPERATIONS",
      "name": "Flujo de caja con análisis de disponibilidad",
      "priority": "critical",
      "expectedBehavior": {
        "routing": "DEBE rutear 'plata en caja' a odoo, NO a tuqui base",
        "toolExecution": "Debe ejecutar queries de account.payment o account.journal",
        "errorHandling": "Si no hay datos, debe sugerir qué verificar"
      },
      "turns": [
        {
          "turn": 1,
          "message": "¿Cuánta plata tenemos disponible hoy en caja?",
          "expectedAgent": "odoo",
          "shouldContain": ["$"],
          "shouldNotSay": ["no tengo acceso", "no puedo", "consultale a tu contador"],
          "mustExecuteTool": "odoo_intelligent_query",
          "timeoutMs": 15000
        },
        {
          "turn": 2,
          "message": "¿Y cuánto vamos a cobrar esta semana?",
          "expectedAgent": "odoo",
          "shouldContain": ["$"],
          "mustExecuteTool": "odoo_intelligent_query",
          "contextAware": true,
          "timeoutMs": 15000
        },
        {
          "turn": 3,
          "message": "¿Alcanza para pagar los sueldos?",
          "expectedAgent": "odoo",
          "shouldContain": ["sueldo", "pago", "alcanza"],
          "contextAware": true,
          "timeoutMs": 15000
        }
      ]
    },
    {
      "id": "CONV_STOCK_001",
      "category": "CONTEXT_OPERATIONS",
      "name": "Gestión de stock con alertas",
      "priority": "high",
      "expectedBehavior": {
        "routing": "DEBE rutear consultas de stock/inventario a odoo",
        "toolExecution": "Debe usar product.product o stock.quant",
        "insights": "Debe sugerir acciones (reordenar, alertar)"
      },
      "turns": [
        {
          "turn": 1,
          "message": "¿Qué productos están por quedarse sin stock?",
          "expectedAgent": "odoo",
          "shouldContain": ["producto", "stock"],
          "shouldNotSay": ["no tengo acceso", "no puedo"],
          "mustExecuteTool": "odoo_intelligent_query",
          "timeoutMs": 15000
        },
        {
          "turn": 2,
          "message": "¿Cuál es el más crítico?",
          "expectedAgent": "odoo",
          "shouldContain": ["producto"],
          "mustExecuteTool": "odoo_intelligent_query",
          "contextAware": true,
          "timeoutMs": 15000
        },
        {
          "turn": 3,
          "message": "¿Cuánto vendimos de ese producto este mes?",
          "expectedAgent": "odoo",
          "shouldContain": ["$"],
          "mustExecuteTool": "odoo_intelligent_query",
          "contextAware": true,
          "timeoutMs": 15000
        }
      ]
    },
    {
      "id": "CONV_WHATSAPP_001",
      "category": "CONTEXT_SALES",
      "name": "WhatsApp: Aclaraciones cortas sin keywords (CRÍTICO - Bug Reportado)",
      "priority": "critical",
      "expectedBehavior": {
        "routing": "Debe mantener agente 'odoo' incluso con mensajes ultra-cortos sin keywords",
        "toolExecution": "NO debe preguntar período repetidamente si ya fue especificado",
        "dataConsistency": "Debe extraer período del historial cuando mensaje no lo menciona"
      },
      "turns": [
        {
          "turn": 1,
          "message": "Que productos de 3M se vendieron en diciembre?",
          "expectedAgent": "odoo",
          "shouldContain": ["producto", "3M"],
          "shouldNotSay": ["no puedo", "no tengo acceso"],
          "mustExecuteTool": "odoo_intelligent_query",
          "timeoutMs": 15000,
          "saveContext": {
            "key": "periodo_especificado",
            "extractPattern": "(diciembre)"
          }
        },
        {
          "turn": 2,
          "message": "Al reporte",
          "expectedAgent": "odoo",
          "shouldNotSay": ["¿En qué período?", "¿Qué período?", "no tengo acceso"],
          "mustExecuteTool": "odoo_intelligent_query",
          "contextAware": true,
          "mustUseContext": "periodo_especificado",
          "timeoutMs": 15000
        },
        {
          "turn": 3,
          "message": "Diciembre 2025",
          "expectedAgent": "odoo",
          "shouldContain": ["producto", "$"],
          "shouldNotSay": ["¿En qué período?", "¿Qué te gustaría saber?"],
          "mustExecuteTool": "odoo_intelligent_query",
          "contextAware": true,
          "timeoutMs": 15000,
          "saveContext": {
            "key": "periodo_refinado",
            "extractPattern": "(diciembre 2025)"
          }
        },
        {
          "turn": 4,
          "message": "Que productos vendimos",
          "expectedAgent": "odoo",
          "shouldContain": ["producto", "$"],
          "shouldNotSay": ["¿En qué período?"],
          "mustExecuteTool": "odoo_intelligent_query",
          "contextAware": true,
          "mustUseContext": "periodo_refinado",
          "timeoutMs": 15000
        }
      ]
    }
  ],
  "performanceBaselines": {
    "maxLatencyPerTurn": 15000,
    "maxConversationTime": 60000,
    "minToolExecutionRate": 0.9,
    "minContextAwarenessRate": 0.85,
    "minSuccessRate": 0.90
  },
  "validationRules": {
    "contextPreservation": "El agente debe recordar datos de turnos anteriores",
    "toolExecution": "NUNCA decir 'voy a buscar' sin ejecutar el tool",
    "dataQuality": "NUNCA usar placeholders como 'Producto A', 'Cliente 1'",
    "routing": "Mantener agente correcto a lo largo de la conversación",
    "performance": "Cada turno debe completar en <15s"
  }
}
